# muscle::Message class [(API)](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html)

```#include "message/Message.h"```

[Message](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html) is the main unit of network and inter-thread communication in MUSCLE.

* Similar to: [BMessage](http://download.unirc.eu/BeOS/Docs/BeBook/The%20Application%20Kit/Message.html), `JSON Message (?)`, `XML (?)`
* Can hold any number of uniquely-named data-fields (up to 2^32)
* Each data field has a UTF-8 name, a fixed type, and 1 or more data-values of that type.
* Supported field-data-types include:  `int8`, `int16`, `int32`, `int64`, `float`, `double`, [String](https://public.msli.com/lcs/muscle/html/classmuscle_1_1String.html), [Message](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html), [Point](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Point.html), [Rect](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Rect.html), plus any arbitrary additional types the user cares to define.
* Each [Message](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html) also includes a single `uint32` "what-code", which is typically used for tagging and quick dispatch (e.g. via a `switch` statement)
* A [Message](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html) is [Flattenable](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Flattenable.html):  i.e. serializable to a platform-neutral flattened-bytes representation that can be saved to disk or transmitted across the network, and later parsed unambiguously under any OS, CPU, or language.
* A [Message](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html) is [RefCountable](https://public.msli.com/lcs/muscle/html/classmuscle_1_1RefCountable.html), which allows efficient (zero-copy) in-process transmission of [Messages](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html) to other threads and functions, and efficient adding of [Message](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html) objects to data structures (like the server-side [DataNode](https://public.msli.com/lcs/muscle/html/classmuscle_1_1DataNode.html) tree)
* Call [AddInt32()](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html#a23131d5cc82ba54d48aaa2deda53fb16)/[AddString()](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html#a25a2686c54cfe4e68c89c04cb6dccf4e)/[AddFloat()](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html#aec9027135529af3b3a9f1acceb4caa02)/[AddMessage()](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html#a762474c971da9887c82265b1a1d0b7dc)/etc to add field-data to a [Message](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html).
* Call [FindInt32()](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html#a0fd9b1e0632678e01ffb301af89bd5dc)/[FindString()](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html#a2e2ef37293ebe8a8a2217a2de7989d19)/[FindFloat()](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html#a0277b64cacc015271ec432675a80aae1)/[FindMessage()](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html#ae8dc02d509ad6d3e934cb3c71a24ec9f)/etc to retrieve field-data from a [Message](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html).
* Call `GetInt32()`/`GetString()`/`GetFloat()`/`GetMessage()`/etc to either retrieve field-data from a [Message](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html), or retrieve a default value if the requested data doesn't exist.
* User-defined types that subclass from [Flattenable](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Flattenable.html), [PseudoFlattenable](https://public.msli.com/lcs/muscle/html/classmuscle_1_1PseudoFlattenable.html), or [FlatCountable](https://public.msli.com/lcs/muscle/html/classmuscle_1_1FlatCountable.html) can be added to a Message by calling `AddFlat()`, either [as pre-flattened bytes](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html#a9d840110ff9313a3c7d90de9eb3b680a) or [as referenced C++ objects](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html#ab85637319b91970976a27c1d0ffbb62e).  Referenced C++ objects will be flattened on-demand, when the Message holding them is flattened.  These objects can be later recovered by calling [FindFlat()](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html#ae7f795ef25eae2ed67f9b579d7a8de8d) or [GetFlat()](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html#a89ce7c7531e912c6b9f434def86a5b98) on the Message.
* User-defined types that subclass from RefCountable can be added to the Message as non-flattening data-items, by calling [AddTag()](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html#a8cf1668fbb10d7c0d7f07203435c7f99).  This can be useful for inter-thread communications.  These objects will not be included in the flattened [Message](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html) data, however.  These objects can be later recovered by calling [FindTag()](https://public.msli.com/lcs/muscle/html/classmuscle_1_1Message.html#a2d1306d081e52e8848256937f41da397) or `GetTag()` on the Message.

Try compiling and running the mini-example-programs in `muscle/html/muscle-by-example/examples/message` (enter `make` to compile example_*, and then run each from Terminal while looking at the corresponding .cpp file)

Quick links to source code of relevant MUSCLE-by-example programs:

* [message/example_1_basic_usage.cpp](https://public.msli.com/lcs/muscle/muscle/html/muscle-by-example/examples/message/example_1_basic_usage.cpp)
* [message/example_2_nested_messages.cpp](https://public.msli.com/lcs/muscle/muscle/html/muscle-by-example/examples/message/example_2_nested_messages.cpp)
* [message/example_3_add_archive.cpp](https://public.msli.com/lcs/muscle/muscle/html/muscle-by-example/examples/message/example_3_add_archive.cpp)
* [message/example_4_add_flat.cpp](https://public.msli.com/lcs/muscle/muscle/html/muscle-by-example/examples/message/example_4_add_flat.cpp)
* [message/example_5_field_iteration.cpp](https://public.msli.com/lcs/muscle/muscle/html/muscle-by-example/examples/message/example_5_field_iteration.cpp)
